---
title: Multi Upload
template: development.jade
---

:markdown
  The ``multi-upload`` block is used to display drag and drop zones for
  multiple files and display status info (progress) to the uploaded files.

h2.heading.heading--secondary Behavior
:markdown
  When a file is dropped into the dropzone or uploaded through the dialog,
  a new element with the status info about this file should be displayed in the
  ``file-list`` block below the ``dropzone``.

.callout.
  Use the dropzone plugin, to handle transitions from and to the dragover state
  of the <code>dropzone</code> block.

:markdown
  Register to the ``ondrop`` event to start uploading the files.

h2.heading.heading--secondary Example
p.paragraph.
  The following is an example which displays the
  different states an upload field can have.

.callout.
  Drag a file and drop it into the dropzone or click on it to select a file
  through the file chooser dialog of your browser to trigger the upload.

.callout.callout--danger.
  There's some information about how to implement file uploads in IE 9 below the examples.

.l-container
  .form
    .form__group
      .form__group__label.
        Datei
      .form__group__control
        .multi-upload(id='example')
          .dropzone
            .dropzone__container(data-dropzone='dropzone')
              input.dropzone__input(type='file')
              .dropzone__icon-container
                i.dropzone__icon.icon.icon--upload
              .dropzone__text-container
                .dropzone__text
                  span Drag file here or
                  | &nbsp;
                  a.dropzone__text__upload-link click to choose
          .multi-upload__remarks
            | Nur Bilder (.jpg, .png, .gif) oder Dokumente (.pdf, .docx).
            br
            | Maximal 2 MB pro Datei
          .file-list

h2.heading.heading--secondary Styles

:sample
  .l-container
    .form
      .form__group
        .form__group__label.
          Datei
        .form__group__control
          .multi-upload
            .dropzone
              .dropzone__container(data-dropzone='dropzone')
                input.dropzone__input(type='file')
                .dropzone__icon-container
                  i.dropzone__icon.icon.icon--upload
                .dropzone__text-container
                  .dropzone__text
                    span Drag file here or
                    | &nbsp;
                    a.dropzone__text__upload-link click to choose
            .multi-upload__remarks
              | Nur Bilder (.jpg, .png, .gif) oder Dokumente (.pdf, .docx).
              br
              | Maximal 2 MB pro Datei
            .file-list
              .file-list__file
                .progressbar
                  .progressbar__description awesome_image.jpg
                  .progressbar__percentage 22%
                  .progressbar__progress
                    .progressbar__progress-background
                      .progressbar__progress-foreground(style='width: 22%')
              .file-list__file
                .file-uploaded
                  .file-uploaded__actions
                    a.file-uploaded__actions__action ansehen
                    a.file-uploaded__actions__action löschen
                  .file-uploaded__title axaswitch.gif
              .file-list__file
                .file-uploaded
                  .file-uploaded__actions
                    a.file-uploaded__actions__action ansehen
                    a.file-uploaded__actions__action löschen
                  .file-uploaded__title superblock.jpg
              .file-list__file
                .file-error
                  .file-error__progressbar.progressbar
                    .progressbar__description awesome_image.jpg
                    .progressbar__error
                      a.progressbar__error-icon.icon.icon--modal-close
                    .progressbar__progress
                      .progressbar__progress-error
                  .file-error__message
                    | Die Datei konnte nicht hochgeladen werden.
                    | Bitte löschen Sie sie aus der Liste und laden sie erneut hoch.
      .form__group
        .form__group__label.
          Fallback for dropzone on IE 9
        .form__group__control
          .multi-upload
            .dropzone-fallback
              input.dropzone-fallback__input(type='file')
              a.dropzone-fallback__button.button.button--primary
                i.dropzone-fallback__button__icon.icon.icon--upload
                span.dropzone-fallback__button__text Click to upload files

h2.heading.heading--secondary IE 9

p.paragraph.
  IE 9 does not support drag and drop functionality for files. It also doesn't
  support the <code>FileReader</code> API. So, just do it like its 2007:

ul.list.list--unordered
  li.list__item.
    Use <code>Modernizr.draganddrop && window.FileReader</code> to detect
    whether drag and drop and the <code>FileReader</code> API are supported so
    you can activate the fallback implementation for the file upload.
  li.list__item.
    Create upload functionality using a hidden <code>iframe</code>.
  li.list__item.
    Replace the <code>dropzone</code> block with the <code>dropzone__fallback</code> block.
    A click on <code>dropzone-fallback__button</code> block must open the
    file chooser dialog.
    After a file is selected, the upload should start. Display status info in the
    <code>file-list</code> block as usual.

script.
  (function () {
    var $example = $('#example');
    var $dropzone = $example.find('.dropzone__container');
    var $fileList = $example.find('.file-list');

    var init = function() {
      $dropzone.on('drop', function(event) {
        event.preventDefault();
        for (var i = 0;i<event.originalEvent.dataTransfer.files.length;i++)
        {
          upload(event.originalEvent.dataTransfer.files[i].name);
        }
      });

      $dropzone.find('.dropzone__text__upload-link').on ('click', function() {
          $example.find('.dropzone__input')[0].click();
        });

      $dropzone.find('.dropzone__input').on('change', fileSelected);
    }

    var fileSelected = function(event) {
      var name = this.value.replace(/\\/g, '/').replace(/.*\//, '')
      upload(name);
    };

    var upload = function (name) {
      var fileStatus = $('<div></div>').addClass('file-list__file');

      var fakeUpload = function () {
        var progressBar = $('<div></div>').addClass('progressbar');

        var progressBarDescription = $('<div></div>').addClass('progressbar__description');
        progressBarDescription.text(name);
        progressBar.append(progressBarDescription);

        var progressBarPercentage = $('<div></div>').addClass('progressbar__percentage');
        progressBarPercentage.text('0%');
        progressBar.append(progressBarPercentage);

        var progressBarProgress = $('<div></div>').addClass('progressbar__progress');
        var progressBarProgressBackground = $('<div></div>').addClass('progressbar__progress-background');

        var progressBarProgressForeground = $('<div></div>').addClass('progressbar__progress-foreground');
        progressBarProgressBackground.append(progressBarProgressForeground);
        progressBarProgress.append(progressBarProgressBackground);
        progressBar.append(progressBarProgress);

        fileStatus.append(progressBar);
        $fileList.append(fileStatus);

        var progressUpdater = function (foreground, percentageElement) {
          var fakeProgressSteps = 5;
          for (i = 0; i <= fakeProgressSteps ; i++) {
            (function (j) {
              setTimeout(function () {
                var width = 100 / fakeProgressSteps * j;
                foreground.css('width', width + '%');
                if (j !== fakeProgressSteps) {
                  percentageElement.text(width.toPrecision(2) + '%');
                }
                else {
                  percentageElement.text('100%');
                  foreground.css('width', '100%');
                  setTimeout(function () {
                    finish();
                  }, 1000);
                }
              }, j*1000);
            })(i);
          }
        };
        progressUpdater(progressBarProgressForeground, progressBarPercentage);
      }

      var finish = function() {
        var fileUploaded = $('<div></div>').addClass('file-uploaded');

        var fileUploadedActions = $('<div></div>').addClass('file-uploaded__actions');

        var viewAction = $('<a></a>').addClass('file-uploaded__actions__action');
        viewAction.text('ansehen');
        fileUploadedActions.append(viewAction);

        var deleteAction = $('<a></a>').addClass('file-uploaded__actions__action');
        deleteAction.text('löschen');
        fileUploadedActions.append(deleteAction);

        var fileUploadedTitle = $('<div></div>').addClass('file-uploaded__title');
        fileUploadedTitle.text(name);

        fileUploaded.append(fileUploadedActions);
        fileUploaded.append(fileUploadedTitle);

        fileStatus.empty();
        fileStatus.append(fileUploaded);
      }

      fakeUpload();
    }

    init();
  })();

// Copyright AXA Versicherungen AG 2015
